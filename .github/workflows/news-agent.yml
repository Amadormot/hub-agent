name: ðŸï¸ Moto Hub News Agent

on:
  # Executa automaticamente 2x por dia (8h e 18h horÃ¡rio de BrasÃ­lia)
  schedule:
    - cron: '0 11 * * *'   # 08:00 BRT (UTC-3)
    - cron: '0 21 * * *'   # 18:00 BRT (UTC-3)
  
  # Permite execuÃ§Ã£o manual pelo GitHub
  workflow_dispatch:
    inputs:
      count:
        description: 'NÃºmero de notÃ­cias para publicar'
        required: false
        default: '3'
      dry_run:
        description: 'Modo simulaÃ§Ã£o (nÃ£o publica)'
        required: false
        default: 'false'
        type: boolean

jobs:
  publish-news:
    runs-on: ubuntu-latest
    name: ðŸ“° Pesquisar e Publicar NotÃ­cias

    steps:
      - name: ðŸ“¥ Checkout do cÃ³digo
        uses: actions/checkout@v4

      - name: ðŸŸ¢ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: ðŸ¤– Executar News Agent
        working-directory: ./agents
        env:
          AGENT_EMAIL: ${{ secrets.AGENT_EMAIL }}
          AGENT_PASSWORD: ${{ secrets.AGENT_PASSWORD }}
        run: |
          if [ "${{ github.event.inputs.dry_run }}" = "true" ]; then
            node news-agent.js --dry-run --count ${{ github.event.inputs.count || '3' }}
          else
            node news-agent.js --count ${{ github.event.inputs.count || '3' }}
          fi

      - name: ðŸ“Š Resumo
        if: always()
        run: echo "âœ… Agente executado em $(date -d '+3 hours' '+%d/%m/%Y %H:%M BRT' 2>/dev/null || date '+%d/%m/%Y %H:%M UTC')"
